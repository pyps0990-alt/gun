<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生存遊戲 - SURVIVAL GAME 2026</title>
    <style>
        /* --- 核心變數 --- */
        :root {
            --bg-color: #050505;
            --main-green: #00ff41; 
            --cyan: #0ff;          
            --alert: #ff3333;      
            --warning: #ffcc00; /* 新增警告色 */
            --dark-grid: rgba(0, 255, 65, 0.05);
            --glass: rgba(0, 20, 0, 0.9);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Consolas', monospace; }
        
        body {
            padding-top: 80px; /* 預留 Header 高度 */
            background-color: var(--bg-color);
            color: var(--main-green);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* 背景特效 */
        body::before {
            content: ""; position: absolute; width: 100%; height: 100%;
            background: linear-gradient(var(--dark-grid) 1px, transparent 1px), linear-gradient(90deg, var(--dark-grid) 1px, transparent 1px);
            background-size: 50px 50px; z-index: -2;
        }
        .scan-line {
            position: absolute; top: 0; left: 0; width: 100%; height: 3px;
            background: rgba(0, 255, 65, 0.4); box-shadow: 0 0 10px var(--main-green);
            animation: scan 5s ease-in-out infinite; z-index: -1; opacity: 0.5;
        }

        /* --- [UPDATED] 固定式導航列 --- */
        header {
            position: fixed; /* 永遠固定 */
            top: 0; left: 0; width: 100%; height: 70px;
            background: rgba(0, 15, 0, 0.95); /* 深色半透明背景 */
            border-bottom: 1px solid var(--main-green);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 2rem; z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.5); 
        }

        /* --- [UPDATED] Logo 設定 --- */
        .logo {
            font-weight: 900; font-size: 1.4rem; color: var(--main-green);
            text-decoration: none; letter-spacing: 2px;
            text-shadow: 0 0 10px var(--main-green);
            display: flex; align-items: center;
        }
        .logo::before {
            content: "///"; margin-right: 10px; color: var(--alert);
        }

        /* --- [NEW] 下拉式選單容器 --- */
        .dropdown { position: relative; display: inline-block; }

        /* 選單按鈕 */
        .drop-btn {
            background: transparent; color: var(--main-green);
            border: 1px solid var(--main-green); padding: 10px 20px;
            font-family: 'Consolas', monospace; font-size: 1rem;
            cursor: pointer; transition: 0.3s;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .drop-btn:hover { background: var(--main-green); color: black; box-shadow: 0 0 15px var(--main-green); }

        /* 下拉內容 (預設隱藏) */
        .dropdown-content {
            display: none; position: absolute; right: 0; top: 100%;
            background-color: #000; min-width: 200px;
            border: 1px solid var(--main-green);
            box-shadow: 0 10px 30px rgba(0, 255, 65, 0.2);
            z-index: 1001;
        }

        /* 連結樣式 */
        .dropdown-content a {
            color: var(--main-green); padding: 12px 16px;
            text-decoration: none; display: block;
            border-bottom: 1px solid rgba(0, 255, 65, 0.2);
            transition: 0.2s; font-size: 0.9rem;
        }
        .dropdown-content a:last-child { border-bottom: none; }
        .dropdown-content a:hover { background: rgba(0, 255, 65, 0.2); padding-left: 25px; }

        /* 顯示選單的 Class */
        .show-menu { display: block; animation: slideDown 0.3s ease; }

        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 主視覺 --- */
        .hero { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; }
        
        .crosshair { position: absolute; width: 60px; height: 60px; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .crosshair::before, .crosshair::after { content: ""; position: absolute; background: var(--main-green); }
        .crosshair::before { width: 100%; height: 1px; top: 50%; left: 0; }
        .crosshair::after { width: 1px; height: 100%; top: 0; left: 50%; }
        .dot { position: absolute; top:50%; left:50%; width: 4px; height: 4px; background: var(--alert); transform: translate(-50%, -50%); box-shadow: 0 0 5px var(--alert); }

        h1 {
            font-size: 4rem; text-transform: uppercase; letter-spacing: 5px;
            text-shadow: 3px 3px 0px rgba(0, 50, 0, 0.8); animation: text-flicker 4s infinite;
            z-index: 2; background: rgba(0,0,0,0.7); padding: 0 20px;
        }
        .chinese-title {
            font-size: 1.5rem; color: var(--cyan); margin-top: 10px; margin-bottom: 20px;
            letter-spacing: 10px; font-weight: bold; text-shadow: 0 0 10px var(--cyan);
        }

        .mission-box {
            margin-top: 2rem; border: 1px solid var(--main-green); background: rgba(0, 20, 0, 0.6);
            padding: 20px; max-width: 500px; text-align: left; position: relative;
        }
        .mission-box::after {
            content: ""; position: absolute; bottom: -5px; right: -5px; width: 15px; height: 15px;
            border-bottom: 2px solid var(--main-green); border-right: 2px solid var(--main-green);
        }
        .mission-box h3 { border-bottom: 1px dashed #444; margin-bottom: 10px; padding-bottom: 5px; color: var(--cyan); }
        .mission-box p { color: #aaa; line-height: 1.6; font-size: 0.9rem; }

        .cta-btn {
            margin-top: 3rem; padding: 15px 50px; border: 2px solid var(--main-green);
            color: black; background: var(--main-green); text-decoration: none; font-weight: 900;
            letter-spacing: 3px; text-transform: uppercase; box-shadow: 0 0 20px rgba(0, 255, 65, 0.4);
            transition: 0.3s; clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
        }
        .cta-btn:hover { background: transparent; color: var(--main-green); box-shadow: 0 0 40px var(--main-green); }

        /* 兩側數據 */
        .side-data { position: absolute; top: 60%; transform: translateY(-50%); font-size: 0.75rem; color: rgba(0, 255, 65, 0.4); line-height: 1.8; pointer-events: none; }
        .left-data { left: 30px; text-align: left; border-left: 2px solid rgba(0,255,65,0.2); padding-left: 10px;}
        .right-data { right: 30px; text-align: right; border-right: 2px solid rgba(0,255,65,0.2); padding-right: 10px;}

        /* RWD */
        @media (max-width: 768px) {
            header { padding: 0 1rem; }
            h1 { font-size: 2.5rem; }
            .side-data { display: none; }
        }

        /* 動畫定義 */
        @keyframes scan { 0% { top: -5%; } 100% { top: 105%; } }
        @keyframes text-flicker { 0% { opacity: 1; } 3% { opacity: 0.8; } 6% { opacity: 1; } 7% { opacity: 0.8; } 8% { opacity: 1; } 9% { opacity: 1; } 10% { opacity: 0.1; } 11% { opacity: 1; } 100% { opacity: 1; } }
        @keyframes pulse-border { 0% { box-shadow: 0 0 0 0 rgba(0, 255, 65, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(0, 255, 65, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 255, 65, 0); } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* HUD CSS */
        #tactical-overlay {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-150%);
            width: 90%; max-width: 400px; background: rgba(0, 15, 0, 0.95); border: 2px solid var(--main-green);
            padding: 15px 20px; z-index: 9999; box-shadow: 0 0 30px rgba(0, 255, 65, 0.3);
            transition: transform 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            display: flex; align-items: center; clip-path: polygon(0 0, 100% 0, 100% 80%, 95% 100%, 5% 100%, 0 80%);
        }
        #tactical-overlay.show { transform: translateX(-50%) translateY(0); }
        .hud-icon { font-size: 2rem; margin-right: 15px; color: var(--main-green); animation: blink 0.5s infinite; }
        .hud-content h4 { margin: 0; color: var(--cyan); text-transform: uppercase; font-size: 0.9rem; letter-spacing: 2px; margin-bottom: 5px; }
        .hud-content p { margin: 0; font-size: 0.8rem; color: #ccc; }
        
        #tactical-overlay.alert-mode { border-color: var(--alert); box-shadow: 0 0 30px rgba(255, 51, 51, 0.3); }
        #tactical-overlay.alert-mode .hud-icon, #tactical-overlay.alert-mode h4 { color: var(--alert); }
    </style>
</head>
<body>
    <div class="scan-line"></div>

    <div id="tactical-overlay">
        <div class="hud-icon">⚠</div>
        <div class="hud-content">
            <h4 id="hud-title">SYSTEM MESSAGE</h4>
            <p id="hud-msg">...</p>
        </div>
    </div>

    <header>
        <a href="index.html" class="logo">軍武交流網</a>
        
        <div class="dropdown">
            <button onclick="toggleMenu()" class="drop-btn">▼ COMMAND MENU</button>
            <div id="myDropdown" class="dropdown-content">
                <a href="school.html">>> 相關學校 (ALLIED)</a>
                <a href="register.html">>> 活動報名 (ENLIST)</a>
                <a href="about.html">>> 關於我們 (INTEL)</a>
                <a href="survival.html">>> 生存指南 (MANUAL)</a>
                <a href="admin.html" style="color:var(--warning); border-top:1px dashed var(--warning)">[!] 管理後台 (ADMIN)</a>
            </div>
        </div>
    </header>

    <div class="side-data left-data">
        >> FIELD DATA<br>氣溫: 26°C<br>濕度: 65%<br>風速: NE 3.2m/s
    </div>
    <div class="side-data right-data">
        >> SQUAD STATUS<br>ALPHA: DEPLOYED<br>BRAVO: STANDBY<br>HOSTILES: DETECTED
    </div>

    <section class="hero">
        <div class="crosshair"><div class="dot"></div></div>
        <h1>SURVIVAL GAME</h1>
        <div class="chinese-title">生存遊戲</div>
        <div class="mission-box">
            <h3>>> CURRENT MISSION</h3>
            <p id="latest-mission-info" style="line-height: 1.8;">
                <span style="color: yellow; animation: blink 1s infinite;">[ CONNECTING TO HQ DATABASE... ]</span>
            </p>
        </div>
        <a href="register.html" class="cta-btn">START MISSION</a>
    </section>

    <script type="module">
        // ★★★ 1. 引用必須放在最上面 ★★★
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, query, orderByKey, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // ★★★ 2. Firebase 設定 (已補上) ★★★
        const firebaseConfig = {
            apiKey: "AIzaSyA_ZvJSGxddMfZ9zfq-51L65UPbSMP_Cng",
            authDomain: "survival-game-6c3c3.firebaseapp.com",
            databaseURL: "https://survival-game-6c3c3-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "survival-game-6c3c3",
            storageBucket: "survival-game-6c3c3.firebasestorage.app",
            messagingSenderId: "403646809893",
            appId: "1:403646809893:web:84d94bcd134dcbeb29bccc"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ★★★ 3. 下拉選單控制 (修正為 window 全域變數) ★★★
        // 因為在 type="module" 裡面，必須掛在 window 下，HTML 的 onclick 才抓得到
        window.toggleMenu = function() {
            document.getElementById("myDropdown").classList.toggle("show-menu");
        };

        // 點擊其他地方關閉選單
        window.onclick = function(event) {
            if (!event.target.matches('.drop-btn')) {
                var dropdowns = document.getElementsByClassName("dropdown-content");
                for (var i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show-menu')) {
                        openDropdown.classList.remove('show-menu');
                    }
                }
            }
        };

        // ★★★ 4. [HUD] 戰術通知系統 ★★★
        const hud = document.getElementById('tactical-overlay');
        const hudTitle = document.getElementById('hud-title');
        const hudMsg = document.getElementById('hud-msg');
        let hideTimer;

        // 將此函式也掛載到 window，方便其他地方呼叫
        window.showTacticalMsg = function(message, isAlert = false) {
            if (!hudMsg) return; // 防止元素不存在時報錯
            hudMsg.innerText = message;
            if (isAlert) {
                hud.classList.add('alert-mode');
                if(hudTitle) hudTitle.innerText = "WARNING / ALERT";
            } else {
                hud.classList.remove('alert-mode');
                if(hudTitle) hudTitle.innerText = "SYSTEM NOTIFICATION";
            }
            hud.classList.add('show');
            clearTimeout(hideTimer);
            hideTimer = setTimeout(() => { hud.classList.remove('show'); }, 3000);
        };

        // ★★★ 5. 自動讀取最新任務邏輯 ★★★
        const missionDisplay = document.getElementById('latest-mission-info');

        if (missionDisplay) { // 確保頁面上有這個元素才執行
            // 建立查詢：只抓取 events 資料夾中「最後一筆 (最新)」資料
            const lastMissionQuery = query(ref(db, 'events'), orderByKey(), limitToLast(1));

            onValue(lastMissionQuery, (snapshot) => {
                // 1. 檢查是否有資料
                if (!snapshot.exists()) {
                    missionDisplay.innerHTML = `<span style="color: gray;">[ NO ACTIVE MISSIONS DETECTED ]</span>`;
                    return;
                }

                // 2. 取出資料
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();

                    // 3. 格式化時間
                    let timeDisplay = "TBD";
                    if (data.eventDate) {
                        timeDisplay = data.eventDate.replace('T', ' '); 
                    }

                    // 4. 更新 HTML 內容
                    missionDisplay.innerHTML = `
                        <span style="color:var(--dim-red)">任務代號：</span> <strong style="color:var(--white); font-size:1.1rem;">${data.name}</strong><br>
                        <span style="color:var(--dim-red)">時間：</span> <span style="color:var(--green)">${timeDisplay} HRS</span><br>
                        <span style="color:var(--dim-red)">人數限制：</span> ${data.maxCapacity} OPERATIVES<br>
                        <span style="color:var(--red); font-size:0.8rem; margin-top:5px; display:inline-block;">⚠️需要許可</span>
                    `;
                });
            });
        }
    </script>
</body>
</html>